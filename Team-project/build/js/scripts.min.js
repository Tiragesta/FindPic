"use strict";var refs={form:document.querySelector(".form"),loadMoreBtn:document.querySelector(".search-load-more__btn"),input:document.querySelector(".search-form__input"),grid:document.querySelector(".search-answer"),page:document.querySelector(".page"),pageHeader:document.querySelector(".page-header"),siteLogo:document.querySelector(".site-logo"),mainPage:document.querySelector(".site-logo__link")},currentPage=1,currentQuery="";function handleFormSubmit(e){e.preventDefault(),""!==(currentQuery=refs.input.value)&&(refs.pageHeader.classList.remove("page-header"),refs.pageHeader.classList.add("is-active"),refs.siteLogo.classList.remove("site-logo"),refs.siteLogo.classList.add("is-click"),currentPage=1,refs.grid.innerHTML="",loadPhotos(),refs.form.reset())}function imagesRequest(e){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,t="https://pixabay.com/api/?key=10502586-9b5f28e8ed93518550ea5da27&q=".concat(e,"&per_page=12&page=").concat(r);return axios.get(t).then(function(e){return e.data.hits}).catch(function(e){console.log(e)})}function createGridItems(e){return e.reduce(function(e,r){return e+'<div class="search-answer__image"><img src="'.concat(r.webformatURL,'" alt=""></div>')},"")}function handleLoadMoreBtnClick(){currentPage+=1,loadPhotos()}function loadPhotos(){imagesRequest(currentQuery,currentPage).then(function(e){var r=createGridItems(e);refs.grid.insertAdjacentHTML("beforeend",r),refs.page.classList.add("show-btn")})}refs.form.addEventListener("submit",handleFormSubmit),refs.loadMoreBtn.addEventListener("click",handleLoadMoreBtnClick),refs.mainPage.addEventListener("click",loadMainPage);var loadMainPage=function(){return refsModal.page.classList.remove("search-answer")},refsModal={page:document.querySelector("body"),form:document.querySelector(".form"),list:document.querySelector(".search-answer"),img:document.querySelector(".pop-up__img"),btnSearch:document.querySelector(".search-form__btn"),delete:document.querySelector(".js-delete"),more:document.querySelector(".js-more"),favorite:document.querySelector(".site-favorite__link"),prev:document.querySelector(".js-prev"),next:document.querySelector(".js-next"),select:document.querySelector(".js-select"),close:document.querySelector(".js-close"),grid:document.querySelector(".search-answer"),pageHeader:document.querySelector(".page-header"),siteLogo:document.querySelector(".site-logo"),popUp:document.querySelector(".pop-up")};function popUpClose(e){e.target!=refsModal.popUp&&e.target!=refsModal.close||refsModal.page.classList.remove("pop-up_active")}function popUpOpen(e){var t,a=Array.from(document.querySelectorAll(".search-answer > div > img")),r=e.target.nodeName;"DIV"===r?t=a.indexOf(e.target.firstChild):"IMG"===r&&(t=a.indexOf(e.target));var o=a[t],s=refsModal.img;void 0!==o&&(s.src=o.src,refsModal.page.classList.add("pop-up_active"),refsModal.next.addEventListener("click",function(){var e;e=t>=a.length-1?t=0:t+1;var r=a[t=e];refsModal.img.src=r.src}),refsModal.prev.addEventListener("click",function(){var e;e=t<=0?t=a.length-1:t-1;var r=a[t=e];refsModal.img.src=r.src}))}refsModal.list.addEventListener("click",popUpOpen,!0),refsModal.close.addEventListener("click",popUpClose),refsModal.popUp.addEventListener("click",popUpClose),refsModal.list.addEventListener("click",handleBtnClick,!0);var array=[];function handleBtnClick(e){e.preventDefault();var r=e.target.src;array.push(r)}function handleSelectBtnClick(){localStorage.setItem("images",JSON.stringify(array))}function handleFavoriteBtnClick(){refsModal.grid.innerHTML="",refsModal.page.classList.remove("show-btn"),refsModal.pageHeader.classList.remove("page-header"),refsModal.pageHeader.classList.add("is-active"),refsModal.siteLogo.classList.remove("site-logo"),refsModal.siteLogo.classList.add("is-click");refsModal.grid.insertAdjacentHTML("beforeend",'<h2 class="site-favorite__link">Избранное</h2>');var e=JSON.parse(localStorage.getItem("images")).reduce(function(e,r){return e+'<div class="search-answer__image"><img src="'.concat(r,'" alt="">\n<button class="btn_remove"></button></div>')},"");refsModal.grid.insertAdjacentHTML("beforeend",e)}function handleDeleteImage(e){"BUTTON"===e.target.nodeName&&e.target.parentNode.remove();removeFromLocalStorage()}function removeFromLocalStorage(r){var e=JSON.parse(localStorage.getItem("images")),t=e.filter(function(e){return e.url===r})[0];e.splice(e.indexOf(t),1),localStorage.setItem("images",JSON.stringify(e))}refsModal.favorite.addEventListener("click",handleFavoriteBtnClick),refsModal.select.addEventListener("click",handleSelectBtnClick),refsModal.list.addEventListener("click",handleDeleteImage);